<div id="shop-content-wrapper">
    <h2>Tienda Celestial üå†</h2>
    <p id="shop-coins-display">Monedas Actuales: <span id="current-shop-coins">Cargando...</span> ü™ô</p>

    <div class="shop-category">
        <h3>Skins de Pergamino üìú</h3>
    </div>
    
    <div class="shop-grid">
        
        <div class="shop-item" data-item="theme-desert" data-price="150" data-style-class="theme-desert">
            <span class="item-icon">üê™</span>
            <p>**Arena del Desierto**</p>
            <p class="item-description">Un tono c√°lido y arenoso. (Fondo Beige)</p>
            <button class="buy-button">Comprar (150 ü™ô)</button>
        </div>
        
        <div class="shop-item" data-item="theme-royal" data-price="400" data-style-class="theme-royal">
            <span class="item-icon">üëë</span>
            <p>**P√∫rpura Real**</p>
            <p class="item-description">La majestuosidad de la realeza b√≠blica. (Fondo Morado Profundo)</p>
            <button class="buy-button">Comprar (400 ü™ô)</button>
        </div>
        
        <div class="shop-item" data-item="theme-egypt" data-price="750" data-style-class="theme-egypt">
            <span class="item-icon">üèõÔ∏è</span>
            <p>**Misterio Egipcio**</p>
            <p class="item-description">El oro y el azul profundo de los faraones. (Fondo Oscuro/Oro)</p>
            <button class="buy-button">Comprar (750 ü™ô)</button>
        </div>

    </div>

</div>

<style>
    /* Estilos para que el modal se vea como una Tienda de Juego */
    #shop-container.modal-content {
        background: linear-gradient(145deg, #1f1f1f, #3a3a3a); /* Fondo oscuro */
        color: white;
        border: 4px solid #FFC107; /* Borde dorado */
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.8);
        padding: 30px;
    }
    
    #shop-content-wrapper {
        max-width: 500px;
        margin: 0 auto;
        text-align: center;
        width: 100%;
    }

    #shop-content-wrapper h2 {
        color: #FFFFFF;
        font-size: 2.5em;
        font-weight: 900;
        text-shadow: 0 0 5px #FFC107;
        margin-bottom: 5px;
    }
    
    #shop-coins-display {
        font-size: 1.2em;
        margin-bottom: 25px;
        color: #A0DEFF;
    }
    
    #current-shop-coins {
        font-weight: bold;
        color: #FFC107;
    }

    .shop-category h3 {
        color: #FFC107;
        border-bottom: 1px solid rgba(255, 255, 255, 0.3);
        padding-bottom: 8px;
        margin-top: 30px;
        margin-bottom: 20px;
        font-size: 1.5em;
    }

    .shop-grid {
        display: flex;
        flex-direction: column; 
        gap: 15px;
    }

    .shop-item {
        background-color: #2c2c2c;
        border: 2px solid #555;
        padding: 15px;
        border-radius: 10px;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        transition: transform 0.2s, border-color 0.2s;
    }
    
    .shop-item:hover {
        transform: translateY(-3px);
        border-color: #007bff;
    }
    
    .shop-item p {
        margin: 5px 0;
        font-size: 1em;
    }
    
    .item-icon { 
        font-size: 2.5em; 
        margin-bottom: 10px;
    }
    
    .item-description {
        font-size: 0.85em;
        color: #aaa;
        margin-bottom: 10px !important;
    }

    .buy-button { 
        background-color: #28a745;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 25px;
        font-weight: bold;
        cursor: pointer;
        transition: background-color 0.2s, transform 0.1s;
        font-size: 1em;
    }
    .buy-button:hover:not(:disabled) {
        background-color: #1e7e34;
        transform: scale(1.05);
    }
    
    .buy-button:disabled {
        background-color: #555;
        cursor: not-allowed;
        opacity: 0.7;
    }
    
    .item-purchased {
        background-color: #FFC107 !important;
        color: #333 !important;
        cursor: default !important;
    }

    .item-purchased:hover {
        transform: none;
    }
</style>

<script>
    // Las variables currentCoins, localStorage y updateCoinDisplay() se asume que est√°n disponibles
    // en el √°mbito global del archivo principal (index.html).

    document.addEventListener('DOMContentLoaded', () => {
        // Ejecuci√≥n inmediata de la l√≥gica de la tienda, una vez que el HTML se ha cargado din√°micamente.
        
        const shopContainer = document.getElementById('shop-content-wrapper');
        
        // 1. SINCRONIZAR MONEDAS
        // Se asume que 'currentCoins' es una variable global en el index.html
        if (typeof currentCoins !== 'undefined') {
            document.getElementById('current-shop-coins').textContent = currentCoins;
        } else {
             // Esto puede ocurrir si el script principal a√∫n no ha inicializado currentCoins.
             // Lo ideal es que el script principal maneje esto.
             document.getElementById('current-shop-coins').textContent = localStorage.getItem('currentCoins') || 20;
        }
        
        // 2. APLICAR ESTADO GUARDADO Y HABILITAR BOTONES
        document.querySelectorAll('.shop-item').forEach(item => {
            const button = item.querySelector('.buy-button');
            const itemKey = item.getAttribute('data-item');
            const itemPrice = parseInt(item.getAttribute('data-price'));

            // a) Chequear si el tema ya est√° comprado y aplicarlo
            const isPurchased = localStorage.getItem(itemKey) === 'true';
            
            if (isPurchased) {
                button.textContent = "¬°Comprado!";
                button.disabled = true;
                button.classList.add('item-purchased');
            }
            
            // b) Asignar el evento de compra
            button.addEventListener('click', function() {
                if (button.disabled) return;

                // Verificaci√≥n final de monedas
                const currentCoinsValue = parseInt(document.getElementById('current-shop-coins').textContent);
                if (currentCoinsValue < itemPrice) {
                    alert("¬°Monedas insuficientes! Contin√∫a jugando para ganar m√°s.");
                    return;
                }
                
                // Confirmaci√≥n y L√≥gica de Compra (Se asume que la funci√≥n existe en el archivo principal)
                if (confirm(`¬øEst√°s seguro de que quieres comprar ${itemKey} por ${itemPrice} monedas?`)) {
                    
                    // Llama a la funci√≥n global para gestionar la compra y el estado del juego
                    if (typeof handleShopPurchase === 'function') {
                        handleShopPurchase(itemKey, itemPrice, item.getAttribute('data-style-class'));
                        
                        // Actualiza el estado visual de este bot√≥n
                        button.textContent = "¬°Comprado!";
                        button.disabled = true;
                        button.classList.add('item-purchased');
                        
                    } else {
                        // L√≥gica de emergencia si la funci√≥n global no est√° definida
                        alert("Error: La l√≥gica de compra no est√° inicializada correctamente en el juego principal.");
                    }
                }
            });
        });
        
        // El script debe llamar a una funci√≥n en el c√≥digo principal para actualizar las monedas y aplicar el tema.
    });

    // Esta funci√≥n actualizar√° el display de monedas si la variable global cambia
    window.updateShopDisplayCoins = function(newCoins) {
         document.getElementById('current-shop-coins').textContent = newCoins;
         // Tambi√©n re-habilita/deshabilita los botones seg√∫n el nuevo saldo
         document.querySelectorAll('.shop-item').forEach(item => {
            const button = item.querySelector('.buy-button');
            const itemPrice = parseInt(item.getAttribute('data-price'));
            
            if (!button.disabled) { // Solo si no est√° ya comprado
                 button.disabled = (newCoins < itemPrice);
            }
         });
    }
</script>
